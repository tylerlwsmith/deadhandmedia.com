{{ define "main" }}
	{{ $posts := getJSON "https://dev.to/api/articles?username=tylerlwsmith&per_page=1000" }}

	<div class="container">
		<main class="content-wrapper">
			<article>
				<h1 class="page__title">{{ .Title }}</h1>
				{{ .Content }}
			</article>

			<div style="display: flex;">
				<div>
					{{ range $posts }}
						<article data-tags="{{ jsonify .tag_list }}">
							<h3><a href="{{ .url }}">{{ .title }}</a></h3>
						</article>
					{{ end }}
				</div>

				{{ if eq hugo.Environment "development" }}
					{{ $tags := newScratch }}	
					{{ $tags.Set "allTags" (slice)}} 
					{{ range $posts }}
						{{ range .tag_list }}
							{{ if in ($tags.Get "allTags") . }}
								{{ $tags.SetInMap "withCount" . (dict "tag" . "count" (add (index ($tags.Get "withCount") .).count 1))  }}
							{{ else }}
								{{ $tags.SetInMap "withCount" . (dict "tag" . "count" 1)  }}
							{{ end }}
							{{ $tags.Add "allTags" . }}
						{{ end }}
					{{ end }}
					<aside style="order: -1; padding: 0 20px 0 0; min-width: 200px;">
						<ul style="margin: 0; list-style: none; padding: 0; font-size: 14px;">
							{{ range sort ($tags.Get "withCount") "tag" "asc" }}
								<li 
									class="blog-tag"
									data-tag="{{ .tag }}"
								>{{ .tag }}: {{ .count }}</li>
							{{ end }}
						</ul>
					</aside>

					<script>
						[...document.querySelectorAll('.blog-tag')].forEach(tag => {
							tag.addEventListener('click', function (event) {
								[...document.querySelectorAll('[data-tags]')].forEach(post => {
									console.log(tag.dataset);
									const hasTag = JSON.parse(post.dataset.tags).indexOf(tag.dataset.tag) > -1;
									post.style.display = hasTag 
										? "block"
										: "none";
								});
							});
						});
					</script>
				{{ end }}
			</div>
		</main>
	</div>
{{ end }}

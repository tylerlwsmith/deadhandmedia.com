{{ define "main" }}
	{{ $posts := getJSON "https://dev.to/api/articles?username=tylerlwsmith&per_page=1000" }}

	<div class="container">
		<main class="content-wrapper">
			<article>
				<h1 class="page__title">{{ .Title }}</h1>
				{{ .Content }}
			</article>

			<div style="display: flex;">
				<div>
					{{ range $posts }}
						<article data-tags="{{ jsonify .tag_list }}">
							<h3><a href="{{ .url }}">{{ .title }}</a></h3>
						</article>
					{{ end }}
				</div>

				{{ if eq hugo.Environment "development" }}
					{{ $tags := newScratch }}	
					{{ $tags.Set "allTags" (slice)}} 
					{{ range $posts }}
						{{ range .tag_list }}
							{{ if in ($tags.Get "allTags") . }}
								{{ $tags.SetInMap "withCount" . (dict "tag" . "count" (add (index ($tags.Get "withCount") .).count 1))  }}
							{{ else }}
								{{ $tags.SetInMap "withCount" . (dict "tag" . "count" 1)  }}
							{{ end }}
							{{ $tags.Add "allTags" . }}
						{{ end }}
					{{ end }}
					<aside style="order: -1; font-size: 14px;">
						<ul style="margin: 0; padding: 0 20px 0 0; list-style: none;">
							{{ range sort ($tags.Get "withCount") "count" "desc" }}
								<li>{{ .tag }}: {{ .count }}</li>
							{{ end }}
						</ul>
					</aside>
				{{ end }}
			</div>
		</main>
	</div>
{{ end }}

{{- $scratch := newScratch -}}	
{{- $scratch.Set "allTags" (slice) -}} 
{{- range (.Scratch.Get "posts") -}}
  {{- range .tag_list -}}
    {{/* Can't use isSet: checks to see if a key's value is null, not if a key exists. */}}
    {{- if in ($scratch.Get "allTags") . -}}
      {{- $scratch.SetInMap "tagCount" . (dict "tag" . "count" (add (index ($scratch.Get "tagCount") .).count 1))  -}}
    {{- else -}}
      {{- $scratch.SetInMap "tagCount" . (dict "tag" . "count" 1)  -}}
    {{- end -}}
    {{- $scratch.Add "allTags" . -}}
  {{- end -}}
{{- end -}}
<div x-cloak>
  <aside
    class="blog-filter__sidebar"
  >
    <div class="blog-filter__sidebar-inner">
      <h3>Filter by Tag</h3>
      <button
        id="reset-filters"
        class="blog-filter__reset-button"
        x-on:click="resetFilters"
        x-bind:disabled="activeFilters.length === 0"
      >
        Reset Filters
      </button>
      <div
        class="blog-filter__sort-button-wrapper"
      >
        <button
          class="blog-filter__sort-button"
          x-on:click="sortTagsBy = SORT_TAGS_BY.COUNT"
          x-bind:class="sortTagsBy === SORT_TAGS_BY.COUNT ? 'blog-filter__sort-button--active' : ''"
        >
          Sort by count
        </button>

        <button
          class="blog-filter__sort-button"
          x-on:click="sortTagsBy = SORT_TAGS_BY.NAME"
          x-bind:class="sortTagsBy === SORT_TAGS_BY.NAME ? 'blog-filter__sort-button--active' : ''"
        >
          Sort by name
        </button>
      </div>
      <ul class="blog-filter__list" data-filter-list>
        {{ range sort ($scratch.Get "tagCount") "count" "desc" }}
          <li 
            class="blog-filter__wrapper"
            data-filter-count="{{ .count }}"
            data-filter-name="{{ .tag }}"
          >
            <input 
              type="checkbox"
              name="{{ .tag }}"
              id="tag:{{ .tag }}"
              class="blog-filter sr-only"
              value="{{ .tag }}"
              x-model="activeFilters"
            >
            <label for="tag:{{ .tag }}" class="blog-filter__label">{{ .tag }}: {{ .count }}</label>
          </li>
        {{ end }}
      </ul>
    </div>
  </aside>
</div>